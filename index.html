<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ev B√ºt√ße Ultra PRO: Ki≈üisel Finans Merkezi</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee; --success: #4cc9f0; --danger: #f72585; 
            --warning: #ff9f1c; --bg: #0b0f1a; --card: #161c2d;
            --border: #2d334a; --text: #f8fafc; --text-dim: #94a3b8;
        }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 20px; font-size: 14px; }
        .container { max-width: 1400px; margin: 0 auto; }
        
        .grid { display: grid; grid-template-columns: 320px 1fr 320px; gap: 20px; }
        @media (max-width: 1200px) { .grid { grid-template-columns: 1fr 1fr; } }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }

        .card { background: var(--card); border-radius: 20px; border: 1px solid var(--border); padding: 20px; margin-bottom: 20px; position: relative; }
        .card h3 { margin: 0 0 15px 0; font-size: 13px; font-weight: 700; text-transform: uppercase; color: var(--success); letter-spacing: 1px; display: flex; align-items: center; justify-content: space-between; }

        .net-worth { font-size: 32px; font-weight: 800; color: #fff; margin: 10px 0; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-box { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px; }
        .stat-label { font-size: 11px; color: var(--text-dim); }
        .stat-val { font-size: 16px; font-weight: 700; margin-top: 5px; display: block; }

        input, select { width: 100%; padding: 12px; background: #0b0f1a; border: 1px solid var(--border); border-radius: 10px; color: #fff; outline: none; margin-bottom: 10px; }
        button { width: 100%; padding: 12px; border-radius: 10px; border: none; font-weight: 700; cursor: pointer; background: var(--primary); color: white; transition: 0.3s; }
        button:hover { opacity: 0.8; transform: translateY(-2px); }
        
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px dotted var(--border); }
        .val-inc { color: var(--success); }
        .val-exp { color: var(--danger); }

        .health-circle { width: 80px; height: 80px; border-radius: 50%; border: 5px solid var(--success); display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 800; margin: 0 auto 15px; }
        .ai-box { background: linear-gradient(45deg, #1e293b, #0b0f1a); border-left: 4px solid var(--primary); padding: 15px; font-style: italic; font-size: 13px; color: #cbd5e1; border-radius: 8px; }

        .progress-w { background: #0b0f1a; height: 6px; border-radius: 10px; margin-top: 8px; }
        .progress-f { height: 100%; background: var(--success); border-radius: 10px; }

        .cat-tag { display: inline-flex; align-items: center; background: var(--border); padding: 5px 10px; border-radius: 20px; font-size: 11px; margin: 2px; }
        .cat-tag span { cursor: pointer; margin-left: 8px; color: var(--danger); font-weight: bold; }
        
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }
    </style>
</head>
<body>

<div class="container">
    <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
        <div>
            <h1 style="margin:0; font-size: 22px; letter-spacing: -1px;">ULTRA <span style="color:var(--primary)">FINANS PRO</span></h1>
            <span id="currentDate" style="color:var(--text-dim); font-size: 12px;"></span>
        </div>
        <div style="display: flex; gap: 10px;">
            <button onclick="exportJSON()" style="width:auto; padding:8px 15px; font-size:11px; background:#334155">YEDEKLE</button>
            <button onclick="importJSON()" style="width:auto; padding:8px 15px; font-size:11px; background:#334155">Y√úKLE</button>
        </div>
    </header>

    <div class="grid">
        
        <div class="col">
            <div class="card">
                <h3>ü§ñ AI DANI≈ûMAN</h3>
                <div id="aiAdvice" class="ai-box">Analiz ediliyor...</div>
            </div>

            <div class="card">
                <h3>ü©∫ SAƒûLIK PUANI</h3>
                <div class="health-circle" id="healthScore">0</div>
                <div id="healthStatus" style="text-align: center; font-weight: 600; font-size: 11px;">Analiz Bekleniyor</div>
            </div>

            <div class="card">
                <h3>üè∑Ô∏è KATEGORƒ∞ Y√ñNETƒ∞Mƒ∞</h3>
                <div style="display: flex; gap: 5px;">
                    <input type="text" id="newCatName" placeholder="Yeni Kategori..." style="margin:0">
                    <button onclick="addCategory()" style="width: 60px;">EKLE</button>
                </div>
                <div id="categoryTags" style="margin-top: 15px; display: flex; flex-wrap: wrap;"></div>
            </div>

            <div class="card">
                <h3>üöÄ NET VARLIK</h3>
                <div class="net-worth" id="netWorthDisplay">0 ‚Ç∫</div>
                <div class="stat-grid">
                    <div class="stat-box"><span class="stat-label">Varlƒ±klar</span><span id="totalAssets" class="stat-val val-inc">0</span></div>
                    <div class="stat-box"><span class="stat-label">Bor√ßlar</span><span id="totalLiabilities" class="stat-val val-exp">0</span></div>
                </div>
            </div>
        </div>

        <div class="col">
            <div class="card">
                <h3>üí≥ ƒ∞≈ûLEM MERKEZƒ∞</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <input type="number" id="amount" placeholder="Tutar">
                    <select id="type">
                        <option value="expense">Gider</option>
                        <option value="income">Gelir</option>
                    </select>
                </div>
                <select id="categorySelect"></select> <input type="text" id="note" placeholder="Not (Opsiyonel)">
                <input type="date" id="date">
                <button onclick="addTransaction()">ƒ∞≈ûLEMƒ∞ KAYDET</button>
            </div>

            <div class="card">
                <h3>üìà HARCAMA DAƒûILIMI</h3>
                <canvas id="mainChart" style="max-height: 250px;"></canvas>
            </div>

            <div class="card">
                <h3>üìú ƒ∞≈ûLEM GE√áMƒ∞≈ûƒ∞</h3>
                <input type="text" id="search" placeholder="Ara..." oninput="render()" style="margin-bottom:10px">
                <div id="historyList" style="max-height: 400px; overflow-y: auto;"></div>
            </div>
        </div>

        <div class="col">
            <div class="card">
                <h3>üíé YATIRIMLAR</h3>
                <input type="text" id="invName" placeholder="Varlƒ±k (Altƒ±n, Borsa vb.)">
                <input type="number" id="invVal" placeholder="Deƒüeri (‚Ç∫)">
                <button onclick="addInvestment()" style="background:var(--success)">PORTF√ñYE EKLE</button>
                <div id="investmentList" style="margin-top:10px"></div>
            </div>

            <div class="card">
                <h3>üìâ BOR√á TAKƒ∞Bƒ∞</h3>
                <input type="text" id="debtName" placeholder="Kime/Nereye?">
                <input type="number" id="debtAmt" placeholder="Bor√ß Tutarƒ±">
                <button onclick="addDebt()" style="background:var(--danger)">BOR√á EKLE</button>
                <div id="debtList" style="margin-top:10px"></div>
            </div>

            <div class="card">
                <h3>üéØ TASARRUF HEDEFLERƒ∞</h3>
                <input type="text" id="goalName" placeholder="Hedefin ne?">
                <input type="number" id="goalAmt" placeholder="Hedef Tutar">
                <button onclick="addGoal()" style="background:var(--warning)">HEDEF BELƒ∞RLE</button>
                <div id="goalList" style="margin-top:10px"></div>
            </div>

            <div class="card">
                <button onclick="clearAll()" style="background:none; color:var(--danger); border:1px solid var(--danger); font-size:10px">VERƒ∞LERƒ∞ SIFIRLA</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Ba≈ülangƒ±√ß Verileri ve Kategori Listesi
    let db = JSON.parse(localStorage.getItem("ultra_pro_v2")) || {
        transactions: [],
        categories: ["Maa≈ü", "Market", "Kira", "Fatura", "Eƒülence", "Saƒülƒ±k", "Ula≈üƒ±m"],
        investments: [],
        debts: [],
        goals: []
    };

    let chart;

    function save() { localStorage.setItem("ultra_pro_v2", JSON.stringify(db)); }

    // Kategori Fonksiyonlarƒ±
    function addCategory() {
        const name = document.getElementById('newCatName').value.trim();
        if(name && !db.categories.includes(name)) {
            db.categories.push(name);
            document.getElementById('newCatName').value = "";
            save(); render();
        }
    }

    function removeCategory(name) {
        if(confirm(`'${name}' kategorisini silmek istiyor musunuz?`)) {
            db.categories = db.categories.filter(c => c !== name);
            save(); render();
        }
    }

    function addTransaction() {
        const amt = Number(document.getElementById('amount').value);
        const cat = document.getElementById('categorySelect').value;
        const type = document.getElementById('type').value;
        const date = document.getElementById('date').value;
        const note = document.getElementById('note').value;

        if(!amt || !cat || !date) return alert("L√ºtfen tutar, kategori ve tarih girin!");

        db.transactions.unshift({ id: Date.now(), amt, cat, type, date, note });
        save(); render();
        document.getElementById('amount').value = ""; document.getElementById('note').value = "";
    }

    function addInvestment() {
        const name = document.getElementById('invName').value;
        const val = Number(document.getElementById('invVal').value);
        if(name && val) { db.investments.push({ id: Date.now(), name, val }); save(); render(); }
    }

    function addDebt() {
        const name = document.getElementById('debtName').value;
        const amt = Number(document.getElementById('debtAmt').value);
        if(name && amt) { db.debts.push({ id: Date.now(), name, amt }); save(); render(); }
    }

    function addGoal() {
        const name = document.getElementById('goalName').value;
        const amt = Number(document.getElementById('goalAmt').value);
        if(name && amt) { db.goals.push({ id: Date.now(), name, amt }); save(); render(); }
    }

    function deleteItem(list, id) {
        db[list] = db[list].filter(item => item.id !== id);
        save(); render();
    }

    function render() {
        // Formdaki Kategori Se√ßimini G√ºncelle
        const catSelect = document.getElementById('categorySelect');
        catSelect.innerHTML = db.categories.map(c => `<option value="${c}">${c}</option>`).join('');

        // Kategori Etiketlerini G√ºncelle (Y√∂netim Paneli)
        const catTags = document.getElementById('categoryTags');
        catTags.innerHTML = db.categories.map(c => `<div class="cat-tag">${c}<span onclick="removeCategory('${c}')">√ó</span></div>`).join('');

        const search = document.getElementById('search').value.toLowerCase();
        let income = 0, expense = 0, invTotal = 0, debtTotal = 0;
        let catStats = {};

        // ƒ∞≈ülemler
        const hist = document.getElementById('historyList'); hist.innerHTML = "";
        db.transactions.forEach(t => {
            if(t.type === 'income') income += t.amt; 
            else { 
                expense += t.amt; 
                catStats[t.cat] = (catStats[t.cat] || 0) + t.amt;
            }

            if(t.cat.toLowerCase().includes(search) || t.note.toLowerCase().includes(search)) {
                hist.innerHTML += `
                <div class="list-item">
                    <div><b>${t.cat}</b><br><small style="color:var(--text-dim)">${t.date} ${t.note ? '‚Ä¢ '+t.note : ''}</small></div>
                    <div style="display:flex; align-items:center">
                        <span class="val-${t.type==='income'?'inc':'exp'}">${t.type==='income'?'+':'-'}${t.amt.toLocaleString()} ‚Ç∫</span>
                        <span onclick="deleteItem('transactions', ${t.id})" style="cursor:pointer; margin-left:10px; opacity:0.3">√ó</span>
                    </div>
                </div>`;
            }
        });

        // Yatƒ±rƒ±mlar
        const invList = document.getElementById('investmentList'); invList.innerHTML = "";
        db.investments.forEach(i => {
            invTotal += i.val;
            invList.innerHTML += `<div class="list-item"><span>${i.name}</span><span class="val-inc">${i.val.toLocaleString()} ‚Ç∫</span></div>`;
        });

        // Bor√ßlar
        const dList = document.getElementById('debtList'); dList.innerHTML = "";
        db.debts.forEach(d => {
            debtTotal += d.amt;
            dList.innerHTML += `<div class="list-item"><span>${d.name}</span><span class="val-exp">${d.amt.toLocaleString()} ‚Ç∫</span></div>`;
        });

        // Dashboard Stats
        const net = (income + invTotal) - (expense + debtTotal);
        document.getElementById('netWorthDisplay').textContent = net.toLocaleString() + " ‚Ç∫";
        document.getElementById('totalAssets').textContent = (income + invTotal).toLocaleString();
        document.getElementById('totalLiabilities').textContent = (expense + debtTotal).toLocaleString();

        updateHealth(income, expense, debtTotal);
        updateChart(catStats);
        runAI(income, expense, invTotal, debtTotal, catStats);
    }

    function updateHealth(inc, exp, debt) {
        let score = 50;
        if(inc > exp) score += 20;
        if(debt === 0) score += 20;
        if(inc > exp * 2) score += 10;
        if(exp > inc) score -= 30;
        score = Math.max(0, Math.min(100, score));
        
        const circle = document.getElementById('healthScore');
        circle.textContent = score;
        circle.style.borderColor = score > 70 ? 'var(--success)' : (score > 40 ? 'var(--warning)' : 'var(--danger)');
        document.getElementById('healthStatus').textContent = score > 70 ? "FINANSAL OLARAK G√ú√áL√úS√úN" : "Dƒ∞KKAT ETMELƒ∞Sƒ∞N";
    }

    function runAI(inc, exp, inv, debt, cats) {
        const advice = document.getElementById('aiAdvice');
        let msg = "Analiz: ";
        let topCat = Object.keys(cats).reduce((a, b) => cats[a] > cats[b] ? a : b, "");
        
        if(topCat) msg += `En √ßok harcama <b>${topCat}</b> kategorisinde. `;
        if(debt > inc) msg += "Bor√ßlarƒ±n aylƒ±k gelirinden fazla! ";
        if(inc > exp) msg += "B√ºt√ßen artƒ± veriyor, yatƒ±rƒ±mlarƒ± artƒ±r.";
        else if(exp > inc) msg += "Giderler geliri a≈ümƒ±≈ü, acil kƒ±sƒ±ntƒ± yap.";
        advice.innerHTML = msg;
    }

    function updateChart(data) {
        const ctx = document.getElementById('mainChart').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: Object.keys(data),
                datasets: [{
                    data: Object.values(data),
                    backgroundColor: ['#4361ee', '#4cc9f0', '#f72585', '#ff9f1c', '#3f37c9', '#4895ef'],
                    borderWidth: 0
                }]
            },
            options: { plugins: { legend: { position: 'bottom', labels: { color: '#94a3b8', boxWidth: 12 } } } }
        });
    }

    function exportJSON() {
        const blob = new Blob([JSON.stringify(db)], {type: "application/json"});
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "Butce_Ultra_Yedek.json";
        a.click();
    }

    function importJSON() {
        const inp = document.createElement('input'); inp.type = 'file';
        inp.onchange = e => {
            const reader = new FileReader();
            reader.onload = () => { db = JSON.parse(reader.result); save(); render(); };
            reader.readAsText(e.target.files[0]);
        };
        inp.click();
    }

    function clearAll() { if(confirm("T√ºm veriler silinecek! Emin misin?")) { localStorage.clear(); location.reload(); } }

    document.getElementById('date').valueAsDate = new Date();
    document.getElementById('currentDate').textContent = new Date().toLocaleDateString('tr-TR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    render();
</script>

</body>
</html>
