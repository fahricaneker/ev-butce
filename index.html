<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fahrican EKER</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">
<link rel="manifest" href="data:application/manifest+json,{%22name%22:%22Ki≈üisel%20CFO%22,%22short_name%22:%22CFO%22,%22start_url%22:%22/%22,%22display%22:%22standalone%22,%22background_color%22:%22%230f172a%22,%22theme_color%22:%22%234361ee%22,%22icons%22:[{%22src%22:%22https://cdn-icons-png.flaticon.com/512/2830/2830284.png%22,%22sizes%22:%22512x512%22,%22type%22:%22image/png%22}]}">
    
    <style>
        :root {
            --primary: #4361ee; --success: #10b981; --danger: #ef4444; 
            --warning: #f59e0b; --info: #3b82f6; --bg: #0f172a; 
            --card: #1e293b; --border: #334155; --text: #f8fafc; --text-dim: #94a3b8;
        }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 20px; font-size: 13px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .grid { display: grid; grid-template-columns: 350px 1fr 350px; gap: 20px; }
        .card { background: var(--card); border-radius: 16px; border: 1px solid var(--border); padding: 20px; margin-bottom: 20px; }
        .card h3 { margin: 0 0 15px 0; font-size: 12px; font-weight: 700; text-transform: uppercase; color: var(--info); }
        .net-worth { font-size: 32px; font-weight: 800; color: #fff; margin-bottom: 5px; }
        
        input, select { width: 100%; padding: 12px; background: #0f172a; border: 1px solid var(--border); border-radius: 8px; color: #fff; margin-bottom: 10px; outline: none; }
        button { width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; background: var(--primary); color: white; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px dashed var(--border); }
        
        .val-inc { color: var(--success); } .val-exp { color: var(--danger); }
        .val-wait { color: var(--warning); opacity: 0.6; font-style: italic; }

        .cat-tag { background: var(--border); padding: 4px 8px; border-radius: 6px; font-size: 10px; display: inline-flex; align-items: center; gap: 5px; margin: 2px; }
        .cat-del { cursor: pointer; color: var(--danger); }
        
        .check-group { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; font-size: 11px; color: var(--text-dim); }
        .check-group input { width: auto; margin: 0; }

        @media (max-width: 1100px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
        <div>
            <h1 style="margin:0; font-size: 22px;">Kƒ∞≈ûƒ∞SEL <span style="color:var(--primary)">CFO PRO</span></h1>
            <small id="todayDisplay" style="color:var(--warning)"></small>
        </div>
        <button onclick="clearAll()" style="width:auto; background:none; color:var(--text-dim); border:1px solid var(--border); padding: 5px 15px;">Sƒ±fƒ±rla</button>
    </header>

    <div class="grid">
        <div class="col">
            <div class="card">
                <h3>üí∞ KASA (BUG√úN)</h3>
                <div class="net-worth" id="netWorthDisplay">0 ‚Ç∫</div>
                <div id="pendingInfo" style="font-size: 11px; color: var(--warning);"></div>
            </div>

            <div class="card">
                <h3>üè∑Ô∏è KATEGORƒ∞ Y√ñNETƒ∞Mƒ∞</h3>
                <div style="display: flex; gap: 5px; margin-bottom: 10px;">
                    <input type="text" id="newCatName" placeholder="Ad..." style="margin:0">
                    <select id="newCatType" style="margin:0; width: 90px;">
                        <option value="income">Gelir</option>
                        <option value="expense">Gider</option>
                    </select>
                    <button onclick="addCustomCategory()" style="width: 45px;">+</button>
                </div>
                <div id="catListDisplay" style="max-height: 200px; overflow-y: auto;"></div>
            </div>

            <div class="card">
                <h3>ü§ñ ANALƒ∞ST NOTU</h3>
                <div id="aiReport" style="font-size: 12px; line-height: 1.5; color: #e2e8f0;">Veri bekleniyor...</div>
            </div>
        </div>

        <div class="col">
            <div class="card">
                <h3>üí≥ ƒ∞≈ûLEM Gƒ∞Rƒ∞≈ûƒ∞</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <input type="number" id="amount" placeholder="Tutar (‚Ç∫)">
                    <select id="transType" onchange="updateCategoryDropdown()">
                        <option value="expense">Gider / √ñdeme (-)</option>
                        <option value="income">Gelir (+)</option>
                    </select>
                </div>
                <select id="categorySelect"></select>
                <input type="date" id="date">
                
                <div class="check-group">
                    <input type="checkbox" id="isRecurring">
                    <label for="isRecurring">Bu i≈ülemi her ay tekrarla</label>
                </div>

                <button onclick="addTransaction()">Sƒ∞STEME KAYDET</button>
            </div>

            <div class="card">
                <h3>üìú ƒ∞≈ûLEM GE√áMƒ∞≈ûƒ∞ VE PLANLAR</h3>
                <div id="historyList" style="max-height: 450px; overflow-y: auto;"></div>
            </div>
        </div>

        <div class="col">
            <div class="card" style="border-top: 3px solid var(--danger);">
                <h3>üìâ BOR√áLARIM</h3>
                <div style="display: flex; gap: 5px; margin-bottom:10px;">
                    <input type="text" id="debtName" placeholder="Bor√ß Adƒ±" style="margin:0">
                    <input type="number" id="debtAmt" placeholder="‚Ç∫" style="margin:0; width: 80px;">
                    <button onclick="addDebt()" style="width: 45px; background:var(--danger)">+</button>
                </div>
                <div id="debtList"></div>
            </div>

            <div class="card" style="border-top: 3px solid var(--success);">
                <h3>üíé VARLIKLARIM</h3>
                <div style="display: flex; gap: 5px; margin-bottom:10px;">
                    <input type="text" id="invName" placeholder="Varlƒ±k" style="margin:0">
                    <input type="number" id="invVal" placeholder="‚Ç∫" style="margin:0; width: 80px;">
                    <button onclick="addInvestment()" style="width: 45px; background:var(--success)">+</button>
                </div>
                <div id="investmentList"></div>
            </div>
        </div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem("cfo_vFinal_db")) || {
        transactions: [],
        categories: {
            income: ["Maa≈ü", "Freelance"],
            expense: ["Market", "Kira", "Fatura"]
        },
        investments: [],
        debts: []
    };

    function save() { localStorage.setItem("cfo_vFinal_db", JSON.stringify(db)); }

    // KATEGORƒ∞ Y√ñNETƒ∞Mƒ∞
    function addCustomCategory() {
        const name = document.getElementById('newCatName').value.trim();
        const type = document.getElementById('newCatType').value;
        if(name && !db.categories[type].includes(name)) {
            db.categories[type].push(name);
            document.getElementById('newCatName').value = "";
            save(); render();
        }
    }

    function removeCategory(type, name) {
        db.categories[type] = db.categories[type].filter(c => c !== name);
        save(); render();
    }

    function updateCategoryDropdown() {
        const type = document.getElementById('transType').value;
        const select = document.getElementById('categorySelect');
        let html = db.categories[type].map(c => `<option value="${c}">${c}</option>`).join('');
        if(type === 'expense') {
            html += `<optgroup label="Bor√ßlar">` + db.debts.map(d => `<option value="BOR√á: ${d.name}">Bor√ß √ñdeme: ${d.name}</option>`).join('') + `</optgroup>`;
        }
        select.innerHTML = html;
    }

    // BOR√á VE VARLIK
    function addDebt() {
        const name = document.getElementById('debtName').value.trim();
        const amt = Number(document.getElementById('debtAmt').value);
        if(name && amt) {
            db.debts.push({ id: Date.now(), name, initial: amt });
            save(); render();
            document.getElementById('debtName').value = ""; document.getElementById('debtAmt').value = "";
        }
    }

    function addInvestment() {
        const name = document.getElementById('invName').value.trim();
        const val = Number(document.getElementById('invVal').value);
        if(name && val) { db.investments.push({ id: Date.now(), name, val }); save(); render(); }
    }

    // ƒ∞≈ûLEM EKLEME
    function addTransaction() {
        const amt = Number(document.getElementById('amount').value);
        const type = document.getElementById('transType').value;
        const cat = document.getElementById('categorySelect').value;
        const date = document.getElementById('date').value;
        const isRec = document.getElementById('isRecurring').checked;

        if(!amt || !date) return alert("Hata: Tutar ve tarih girin.");

        db.transactions.unshift({ id: Date.now(), amt, type, cat, date, recurring: isRec });
        save(); render();
        document.getElementById('amount').value = "";
        document.getElementById('isRecurring').checked = false;
    }

    function render() {
        const today = new Date(); today.setHours(0,0,0,0);
        document.getElementById('todayDisplay').textContent = "Bug√ºn: " + today.toLocaleDateString('tr-TR');
        updateCategoryDropdown();

        // Kategori Listesini G√∂ster
        let catHTML = "<b>Gelir:</b><br>";
        db.categories.income.forEach(c => catHTML += `<span class="cat-tag">${c}<span class="cat-del" onclick="removeCategory('income','${c}')">√ó</span></span>`);
        catHTML += "<br><br><b>Gider:</b><br>";
        db.categories.expense.forEach(c => catHTML += `<span class="cat-tag">${c}<span class="cat-del" onclick="removeCategory('expense','${c}')">√ó</span></span>`);
        document.getElementById('catListDisplay').innerHTML = catHTML;

        let cash = 0, pInc = 0, pExp = 0;
        let debtBalances = {};
        db.debts.forEach(d => debtBalances[d.name] = d.initial);

        // ƒ∞≈ûLEMLERƒ∞ VE KASAYI HESAPLA
        const hList = document.getElementById('historyList'); hList.innerHTML = "";
        db.transactions.sort((a,b) => new Date(b.date) - new Date(a.date)).forEach(t => {
            const tDate = new Date(t.date); tDate.setHours(0,0,0,0);
            const isFuture = tDate > today;

            if(!isFuture) {
                if(t.type === 'income') cash += t.amt;
                else {
                    cash -= t.amt;
                    if(t.cat.startsWith("BOR√á: ")) {
                        const dName = t.cat.replace("BOR√á: ", "");
                        if(debtBalances[dName] !== undefined) debtBalances[dName] -= t.amt;
                    }
                }
            } else {
                if(t.type === 'income') pInc += t.amt; else pExp += t.amt;
            }

            hList.innerHTML += `
                <div class="list-item" style="${isFuture ? 'opacity:0.6; border-left:3px solid var(--warning); padding-left:8px;' : ''}">
                    <div><b>${t.cat}</b> ${t.recurring ? 'üîÑ' : ''}<br><small>${t.date} ${isFuture ? '(BEKLEYEN)' : ''}</small></div>
                    <span class="${isFuture ? 'val-wait' : (t.type === 'income' ? 'val-inc' : 'val-exp')}">
                        ${t.type === 'income' ? '+' : '-'}${t.amt.toLocaleString()} ‚Ç∫
                    </span>
                </div>`;
        });

        // BOR√á Lƒ∞STESƒ∞Nƒ∞ G√úNCELLE
        const dList = document.getElementById('debtList'); dList.innerHTML = "";
        let totalRemainingDebt = 0;
        db.debts.forEach(d => {
            const rem = debtBalances[d.name];
            totalRemainingDebt += rem;
            dList.innerHTML += `<div class="list-item"><span>${d.name}</span><span class="${rem <= 0 ? 'val-inc' : 'val-exp'}">${rem.toLocaleString()} ‚Ç∫</span></div>`;
        });

        // VARLIKLAR
        let totalInv = 0;
        const iList = document.getElementById('investmentList'); iList.innerHTML = "";
        db.investments.forEach(i => {
            totalInv += i.val;
            iList.innerHTML += `<div class="list-item"><span>${i.name}</span><span class="val-inc">${i.val.toLocaleString()} ‚Ç∫</span></div>`;
        });

        // DASHBOARD
        document.getElementById('netWorthDisplay').textContent = (cash + totalInv).toLocaleString() + " ‚Ç∫";
        document.getElementById('pendingInfo').innerHTML = `Gelecek Planƒ±: <span class="val-inc">+${pInc.toLocaleString()}</span> / <span class="val-exp">-${pExp.toLocaleString()} ‚Ç∫</span>`;

        // AI
        let aiMsg = "";
        if (pExp > (cash + pInc)) aiMsg = "‚ö†Ô∏è <b>KRƒ∞Tƒ∞K:</b> Gelecek √∂demelerin eldeki nakdini a≈üƒ±yor! Harcama planƒ±nƒ± revize et.";
        else if (pExp > 0) aiMsg = `‚úÖ Mart ayƒ± i√ßin <b>${pExp.toLocaleString()} ‚Ç∫</b> √∂demen planlanmƒ±≈ü. Kasan ≈üu an g√ºvende.`;
        else aiMsg = "Sistem stabil. Yeni i≈ülem bekleniyor.";
        document.getElementById('aiReport').innerHTML = aiMsg;
    }

    function clearAll() { if(confirm("Her ≈üey silinsin mi?")) { localStorage.clear(); location.reload(); } }
    document.getElementById('date').valueAsDate = new Date();
    render();
</script>
</body>
</html>
