<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ev B√ºt√ße Ultra PRO</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee; --secondary: #3f37c9; --success: #4cc9f0;
            --danger: #f72585; --warning: #ff9f1c; --bg: #f8f9fc;
            --card-bg: #ffffff; --text: #2b2d42; --border: #edf2f4;
        }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; transition: all 0.2s ease; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* Dashboard Grid */
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: var(--card-bg); padding: 20px; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border: 1px solid var(--border); }
        .stat-card h4 { margin: 0; font-size: 13px; color: #8d99ae; text-transform: uppercase; letter-spacing: 1px; }
        .stat-card p { margin: 10px 0 0; font-size: 24px; font-weight: 700; }

        /* Ana B√∂l√ºmler */
        .grid-layout { display: grid; grid-template-columns: 1.5fr 1fr; gap: 20px; }
        @media (max-width: 768px) { .grid-layout { grid-template-columns: 1fr; } }

        .card { background: var(--card-bg); padding: 25px; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid var(--border); }
        h3 { margin-top: 0; font-size: 18px; display: flex; align-items: center; gap: 10px; }

        /* Formlar */
        .form-group { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px; }
        input, select { flex: 1; padding: 12px; border: 1px solid var(--border); border-radius: 10px; outline: none; background: #fefefe; font-size: 14px; min-width: 140px; }
        input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1); }
        button { padding: 12px 20px; border-radius: 10px; border: none; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; width: 100%; }
        .btn-primary:hover { background: var(--secondary); transform: translateY(-1px); }

        /* Liste Tasarƒ±mƒ± */
        .transaction-list { max-height: 400px; overflow-y: auto; padding-right: 5px; }
        .t-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid var(--border); border-radius: 8px; }
        .t-item:hover { background: #fcfcfd; }
        .t-info { display: flex; flex-direction: column; }
        .t-info small { color: #8d99ae; font-size: 11px; }
        .t-amount { font-weight: 700; font-size: 15px; }
        .income-text { color: #2ecc71; }
        .expense-text { color: var(--danger); }
        .delete-btn { color: #bdc3c7; cursor: pointer; margin-left: 10px; font-size: 18px; }
        .delete-btn:hover { color: var(--danger); }

        /* Limit Bar */
        .limit-item { margin-bottom: 15px; }
        .limit-header { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 5px; }
        .progress-bg { background: #eee; height: 8px; border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0; }

        .tabs { display: flex; gap: 10px; margin-bottom: 15px; }
        .tab-btn { padding: 8px 15px; background: #eee; border-radius: 20px; font-size: 12px; cursor: pointer; }
        .tab-btn.active { background: var(--primary); color: white; }
    </style>
</head>
<body>

<div class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
        <h2 style="margin:0;">üöÄ Ev B√ºt√ße <span style="color:var(--primary)">Ultra PRO</span></h2>
        <div id="currentMonthDisplay" style="font-weight: 600; color: var(--primary);"></div>
    </div>

    <div class="dashboard">
        <div class="stat-card">
            <h4>Toplam Bakiye</h4>
            <p id="totalBalance">0 ‚Ç∫</p>
        </div>
        <div class="stat-card">
            <h4>Bu Ay Gider</h4>
            <p id="monthExpense" style="color: var(--danger);">0 ‚Ç∫</p>
        </div>
        <div class="stat-card">
            <h4>Aylƒ±k Tasarruf</h4>
            <p id="monthSaving" style="color: #2ecc71;">0 ‚Ç∫</p>
        </div>
    </div>

    <div class="grid-layout">
        <div class="main-content">
            <div class="card">
                <h3>üí∞ Yeni ƒ∞≈ülem</h3>
                <div class="form-group">
                    <input type="number" id="amount" placeholder="Tutar">
                    <select id="type">
                        <option value="expense">Gider (-)</option>
                        <option value="income">Gelir (+)</option>
                    </select>
                    <input type="text" id="category" placeholder="Kategori (Market, Kira...)" list="categoryList">
                    <datalist id="categoryList"></datalist>
                    <input type="date" id="date">
                    <input type="text" id="note" placeholder="Not (Opsiyonel)" style="width: 100%;">
                </div>
                <button class="btn-primary" onclick="addTransaction()">ƒ∞≈ülemi Kaydet</button>
            </div>

            <div class="card">
                <h3>üìä Harcama Analizi</h3>
                <div class="tabs">
                    <div class="tab-btn active" onclick="updateCharts('pie')">Kategoriler</div>
                    <div class="tab-btn" onclick="updateCharts('line')">Zaman √áizelgesi</div>
                </div>
                <canvas id="mainChart" style="max-height: 300px;"></canvas>
            </div>

            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>üìú ƒ∞≈ülem Ge√ßmi≈üi</h3>
                    <input type="text" id="search" placeholder="Ara..." oninput="renderUI()" style="width: 150px; padding: 5px 10px;">
                </div>
                <div id="transactionList" class="transaction-list"></div>
            </div>
        </div>

        <div class="sidebar">
            <div class="card">
                <h3>üéØ Kategori Limitleri</h3>
                <div class="form-group" style="flex-direction: column;">
                    <input type="text" id="limitCat" placeholder="Kategori">
                    <input type="number" id="limitVal" placeholder="Aylƒ±k Limit (‚Ç∫)">
                    <button class="btn-primary" onclick="setLimit()" style="background: var(--text);">Limit Belirle</button>
                </div>
                <div id="limitList" style="margin-top: 20px;"></div>
            </div>

            <div class="card">
                <h3>‚öôÔ∏è Veri Y√∂netimi</h3>
                <button class="btn-primary" onclick="exportData()" style="background:#f1f2f6; color:#2f3542; margin-bottom:10px;">Excel/CSV Dƒ±≈üa Aktar</button>
                <div style="display: flex; gap: 5px;">
                    <button class="btn-primary" onclick="backupJSON()" style="background:#747d8c; flex:1">Yedekle</button>
                    <button class="btn-primary" onclick="document.getElementById('importFile').click()" style="background:#747d8c; flex:1">Y√ºkle</button>
                </div>
                <input type="file" id="importFile" hidden onchange="importJSON(event)">
                <button onclick="clearAllData()" style="background:none; color:var(--danger); border:none; width:100%; font-size:11px; margin-top:15px; cursor:pointer;">T√ºm Verileri Sƒ±fƒ±rla</button>
            </div>
        </div>
    </div>
</div>

<script>
    let transactions = JSON.parse(localStorage.getItem("pro_transactions")) || [];
    let limits = JSON.parse(localStorage.getItem("pro_limits")) || {};
    let chartInstance = null;

    // Ba≈ülangƒ±√ß Ayarlarƒ±
    document.getElementById('date').valueAsDate = new Date();
    const currentMonth = new Date().toLocaleString('tr-TR', { month: 'long', year: 'numeric' });
    document.getElementById('currentMonthDisplay').textContent = currentMonth;

    function save() {
        localStorage.setItem("pro_transactions", JSON.stringify(transactions));
        localStorage.setItem("pro_limits", JSON.stringify(limits));
    }

    function addTransaction() {
        const amount = Number(document.getElementById('amount').value);
        const category = document.getElementById('category').value;
        const date = document.getElementById('date').value;
        const type = document.getElementById('type').value;
        const note = document.getElementById('note').value;

        if (!amount || !category || !date) return alert("L√ºtfen temel alanlarƒ± doldurun.");

        transactions.unshift({ id: Date.now(), amount, category, date, type, note });
        save();
        renderUI();
        
        // Form Temizle
        document.getElementById('amount').value = "";
        document.getElementById('category').value = "";
        document.getElementById('note').value = "";
    }

    function deleteTransaction(id) {
        transactions = transactions.filter(t => t.id !== id);
        save();
        renderUI();
    }

    function setLimit() {
        const cat = document.getElementById('limitCat').value;
        const val = Number(document.getElementById('limitVal').value);
        if (cat && val) {
            limits[cat] = val;
            save();
            renderUI();
            document.getElementById('limitCat').value = "";
            document.getElementById('limitVal').value = "";
        }
    }

    function renderUI() {
        const search = document.getElementById('search').value.toLowerCase();
        const list = document.getElementById('transactionList');
        const now = new Date();
        const thisMonth = now.getMonth();
        const thisYear = now.getFullYear();

        let totals = { income: 0, expense: 0, monthExp: 0 };
        let catUsage = {};
        
        list.innerHTML = "";
        
        // ƒ∞≈ülemleri ƒ∞≈üle
        transactions.forEach(t => {
            const tDate = new Date(t.date);
            const isThisMonth = tDate.getMonth() === thisMonth && tDate.getFullYear() === thisYear;

            if (t.type === 'income') {
                totals.income += t.amount;
            } else {
                totals.expense += t.amount;
                if (isThisMonth) {
                    totals.monthExp += t.amount;
                    catUsage[t.category] = (catUsage[t.category] || 0) + t.amount;
                }
            }

            // Listeleme (Arama filtresine g√∂re)
            if (t.category.toLowerCase().includes(search) || t.note.toLowerCase().includes(search)) {
                list.innerHTML += `
                    <div class="t-item">
                        <div class="t-info">
                            <strong>${t.category}</strong>
                            <small>${t.date} ${t.note ? '‚Ä¢ ' + t.note : ''}</small>
                        </div>
                        <div style="display:flex; align-items:center">
                            <span class="t-amount ${t.type}-text">${t.type === 'income' ? '+' : '-'}${t.amount.toLocaleString()} ‚Ç∫</span>
                            <span class="delete-btn" onclick="deleteTransaction(${t.id})">√ó</span>
                        </div>
                    </div>`;
            }
        });

        // Dashboard G√ºncelle
        document.getElementById('totalBalance').textContent = (totals.income - totals.expense).toLocaleString() + " ‚Ç∫";
        document.getElementById('monthExpense').textContent = totals.monthExp.toLocaleString() + " ‚Ç∫";
        document.getElementById('monthSaving').textContent = (totals.income - totals.expense > 0 ? totals.income - totals.expense : 0).toLocaleString() + " ‚Ç∫";

        // Limitleri G√ºncelle
        const limitList = document.getElementById('limitList');
        limitList.innerHTML = "";
        for (let cat in limits) {
            const used = catUsage[cat] || 0;
            const perc = Math.min((used / limits[cat]) * 100, 100);
            const color = perc > 90 ? 'var(--danger)' : (perc > 70 ? 'var(--warning)' : 'var(--primary)');
            
            limitList.innerHTML += `
                <div class="limit-item">
                    <div class="limit-header">
                        <span>${cat}</span>
                        <span>${used.toLocaleString()} / ${limits[cat].toLocaleString()} ‚Ç∫</span>
                    </div>
                    <div class="progress-bg">
                        <div class="progress-fill" style="width:${perc}%; background:${color}"></div>
                    </div>
                </div>`;
        }

        updateCharts('pie', catUsage);
        updateCategoryDatalist();
    }

    function updateCharts(type, catData = null) {
        const ctx = document.getElementById('mainChart').getContext('2d');
        if (chartInstance) chartInstance.destroy();

        if (!catData) {
            catData = {};
            const thisMonth = new Date().getMonth();
            transactions.forEach(t => {
                if (t.type === 'expense' && new Date(t.date).getMonth() === thisMonth) {
                    catData[t.category] = (catData[t.category] || 0) + t.amount;
                }
            });
        }

        if (type === 'pie') {
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(catData),
                    datasets: [{
                        data: Object.values(catData),
                        backgroundColor: ['#4361ee', '#f72585', '#4cc9f0', '#ff9f1c', '#3f37c9', '#7209b7']
                    }]
                },
                options: { plugins: { legend: { position: 'bottom' } } }
            });
        } else {
            // Zaman √áizelgesi
            const daily = {};
            transactions.slice(0, 15).reverse().forEach(t => {
                daily[t.date] = (daily[t.date] || 0) + (t.type === 'income' ? t.amount : -t.amount);
            });
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Object.keys(daily),
                    datasets: [{
                        label: 'G√ºnl√ºk Net Deƒüi≈üim',
                        data: Object.values(daily),
                        borderColor: '#4361ee',
                        tension: 0.4,
                        fill: true,
                        backgroundColor: 'rgba(67, 97, 238, 0.1)'
                    }]
                }
            });
        }
        
        // Tab styling
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        event?.target?.classList?.add('active');
    }

    function updateCategoryDatalist() {
        const list = document.getElementById('categoryList');
        const cats = [...new Set(transactions.map(t => t.category))];
        list.innerHTML = cats.map(c => `<option value="${c}">`).join('');
    }

    // Dƒ±≈üa Aktar / Yedekle
    function exportData() {
        let csv = "\uFEFFTarih,Kategori,Tip,Tutar,Not\n";
        transactions.forEach(t => csv += `${t.date},${t.category},${t.type},${t.amount},${t.note}\n`);
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = `Butce_Rapor_${new Date().toLocaleDateString()}.csv`;
        link.click();
    }

    function backupJSON() {
        const data = JSON.stringify({ transactions, limits });
        const blob = new Blob([data], { type: 'application/json' });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "butce_yedek_pro.json";
        link.click();
    }

    function importJSON(e) {
        const reader = new FileReader();
        reader.onload = (event) => {
            const data = JSON.parse(event.target.result);
            transactions = data.transactions || [];
            limits = data.limits || {};
            save();
            renderUI();
            alert("Veriler ba≈üarƒ±yla y√ºklendi!");
        };
        reader.readAsText(e.target.files[0]);
    }

    function clearAllData() {
        if (confirm("Dƒ∞KKAT! T√ºm verileriniz kalƒ±cƒ± olarak silinecektir. Emin misiniz?")) {
            localStorage.clear();
            location.reload();
        }
    }

    // Ba≈ülat
    renderUI();
</script>

</body>
</html>
