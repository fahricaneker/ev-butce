<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ev Bütçe Ultra</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:Arial;background:#f4f6f9;padding:15px}
h2{text-align:center}
.card{background:#fff;padding:15px;margin-top:15px;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,.05)}
input,select,button{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:1px solid #ddd}
button{background:#2e86de;color:#fff;border:none}
button:hover{opacity:.9}
.list-item{display:flex;justify-content:space-between;padding:8px;border-bottom:1px solid #eee;font-size:14px}
.delete{color:red;cursor:pointer}
.progress{background:#ddd;border-radius:20px;height:15px;margin-top:10px}
.progress-bar{height:100%;background:#27ae60;border-radius:20px;width:0%}
.stat{font-size:14px;color:#555;margin-top:5px}
.hidden{display:none}
</style>
</head>
<body>

<h2>Ev Bütçe Ultra</h2>

<div class="card">
<input id="amount" type="number" placeholder="Tutar">
<select id="type">
<option value="income">Gelir</option>
<option value="expense">Gider</option>
</select>
<input id="category" placeholder="Kategori">
<input id="date" type="date">
<button onclick="addTransaction()">Ekle</button>
</div>

<div class="card">
<input id="search" placeholder="Kategori ara..." oninput="updateUI()">
</div>

<div class="card">
<p>Gelir: <span id="income">0</span> ₺</p>
<p>Gider: <span id="expense">0</span> ₺</p>
<p><b>Kalan: <span id="balance">0</span> ₺</b></p>
<p class="stat">En Çok Harcanan: <span id="topCategory">-</span></p>
<p class="stat">Son 7 Gün Gider: <span id="last7">0</span> ₺</p>
</div>

<div class="card">
<input id="goal" type="number" placeholder="Birikim Hedefi">
<button onclick="setGoal()">Hedef Belirle</button>
<div class="progress"><div class="progress-bar" id="progressBar"></div></div>
<p>İlerleme: <span id="goalPercent">0</span>%</p>
</div>

<div class="card">
<canvas id="pieChart"></canvas>
<canvas id="lineChart"></canvas>
</div>

<div class="card">
<h3>İşlemler</h3>
<div id="list"></div>
</div>

<div class="card">
<button onclick="exportCSV()">CSV</button>
<button onclick="backupJSON()">Yedek Al</button>
<input type="file" onchange="restoreJSON(event)">
</div>

<script>
let transactions=JSON.parse(localStorage.getItem("transactions"))||[];
let goal=Number(localStorage.getItem("goal"))||0;
let pie,line;

function save(){
localStorage.setItem("transactions",JSON.stringify(transactions));
localStorage.setItem("goal",goal);
}

function addTransaction(){
if(!amount.value||!category.value||!date.value)return;
transactions.push({
amount:Number(amount.value),
type:type.value,
category:category.value,
date:date.value
});
save();updateUI();
amount.value="";category.value="";
}

function deleteTransaction(i){
transactions.splice(i,1);
save();updateUI();
}

function setGoal(){
goal=Number(goalInput.value);
save();updateUI();
}

function exportCSV(){
let csv="Tarih,Kategori,Tip,Tutar\n";
transactions.forEach(t=>{
csv+=`${t.date},${t.category},${t.type},${t.amount}\n`;
});
let blob=new Blob([csv],{type:"text/csv"});
let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="butce.csv";
a.click();
}

function backupJSON(){
let blob=new Blob([JSON.stringify({transactions,goal})],{type:"application/json"});
let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="yedek.json";
a.click();
}

function restoreJSON(e){
let reader=new FileReader();
reader.onload=function(){
let data=JSON.parse(reader.result);
transactions=data.transactions||[];
goal=data.goal||0;
save();updateUI();
};
reader.readAsText(e.target.files[0]);
}

function updateUI(){
let income=0,expense=0;
let categories={};
let last7=0;
let searchTerm=search.value.toLowerCase();
list.innerHTML="";

transactions.forEach((t,i)=>{
if(searchTerm && !t.category.toLowerCase().includes(searchTerm))return;

if(t.type==="income")income+=t.amount;
else{
expense+=t.amount;
let diff=(new Date()-new Date(t.date))/(1000*60*60*24);
if(diff<=7)last7+=t.amount;
}

if(!categories[t.category])categories[t.category]=0;
if(t.type==="expense")categories[t.category]+=t.amount;

list.innerHTML+=`
<div class="list-item">
<span>${t.date} | ${t.category} - ${t.amount}₺</span>
<span class="delete" onclick="deleteTransaction(${i})">Sil</span>
</div>`;
});

incomeSpan.textContent=income;
expenseSpan.textContent=expense;
balanceSpan.textContent=income-expense;
last7Span.textContent=last7;

let top="-";
let max=0;
for(let c in categories){
if(categories[c]>max){max=categories[c];top=c;}
}
topCategory.textContent=top;

let percent=goal?((income-expense)/goal)*100:0;
percent=Math.max(0,Math.min(100,percent));
progressBar.style.width=percent+"%";
goalPercent.textContent=Math.round(percent);

drawCharts(income,expense);
}

function drawCharts(income,expense){
if(pie)pie.destroy();
if(line)line.destroy();

pie=new Chart(pieChart,{
type:"doughnut",
data:{labels:["Gelir","Gider"],
datasets:[{data:[income,expense],backgroundColor:["#27ae60","#e74c3c"]}]}
});

let daily={};
transactions.forEach(t=>{
if(!daily[t.date])daily[t.date]=0;
daily[t.date]+=t.type==="income"?t.amount:-t.amount;
});

line=new Chart(lineChart,{
type:"line",
data:{
labels:Object.keys(daily),
datasets:[{data:Object.values(daily),borderColor:"#2e86de",fill:false}]
}
});
}

const amount=document.getElementById("amount");
const type=document.getElementById("type");
const category=document.getElementById("category");
const date=document.getElementById("date");
const search=document.getElementById("search");
const incomeSpan=document.getElementById("income");
const expenseSpan=document.getElementById("expense");
const balanceSpan=document.getElementById("balance");
const topCategory=document.getElementById("topCategory");
const last7Span=document.getElementById("last7");
const goalInput=document.getElementById("goal");
const progressBar=document.getElementById("progressBar");
const goalPercent=document.getElementById("goalPercent");
const list=document.getElementById("list");
const pieChart=document.getElementById("pieChart");
const lineChart=document.getElementById("lineChart");

updateUI();
</script>

</body>
</html>
