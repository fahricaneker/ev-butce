<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fahrican EKER</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee; --success: #10b981; --danger: #ef4444; 
            --warning: #f59e0b; --info: #3b82f6; --bg: #0f172a; 
            --card: #1e293b; --border: #334155; --text: #f8fafc; --text-dim: #94a3b8;
        }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 20px; font-size: 13px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .grid { display: grid; grid-template-columns: 350px 1fr 350px; gap: 20px; }
        .card { background: var(--card); border-radius: 16px; border: 1px solid var(--border); padding: 20px; margin-bottom: 20px; }
        .card h3 { margin: 0 0 15px 0; font-size: 12px; font-weight: 700; text-transform: uppercase; color: var(--info); }
        .net-worth { font-size: 32px; font-weight: 800; color: #fff; margin-bottom: 5px; }
        
        input, select { width: 100%; padding: 12px; background: #0f172a; border: 1px solid var(--border); border-radius: 8px; color: #fff; margin-bottom: 10px; }
        button { width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; background: var(--primary); color: white; transition: 0.2s; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px dashed var(--border); }
        .val-inc { color: var(--success); } .val-exp { color: var(--danger); }
        .val-wait { color: var(--warning); opacity: 0.7; } /* Gelecek tarihli i≈ülemler */

        .check-group { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; color: var(--text-dim); }
        .check-group input { width: auto; margin: 0; }
        
        @media (max-width: 1100px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
        <div>
            <h1 style="margin:0; font-size: 22px;">Kƒ∞≈ûƒ∞SEL <span style="color:var(--primary)">CFO: ZAMANLI TAKƒ∞P</span></h1>
            <small id="todayStr" style="color:var(--warning)"></small>
        </div>
        <button onclick="clearAll()" style="width:auto; background:none; color:var(--text-dim); border:1px solid var(--border); padding: 5px 15px;">Sƒ±fƒ±rla</button>
    </header>

    <div class="grid">
        <div class="col">
            <div class="card">
                <h3>üí∞ MEVCUT KASA (BUG√úN)</h3>
                <div class="net-worth" id="netWorthDisplay">0 ‚Ç∫</div>
                <div id="pendingInfo" style="font-size: 11px; color: var(--warning);"></div>
            </div>

            <div class="card">
                <h3>ü§ñ ANALƒ∞Z VE √ñNG√ñR√ú</h3>
                <div id="aiReport" style="line-height: 1.5; color: #e2e8f0;">Veri bekleniyor...</div>
            </div>
        </div>

        <div class="col">
            <div class="card">
                <h3>üí≥ AKILLI ƒ∞≈ûLEM EKLE</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <input type="number" id="amount" placeholder="Tutar (‚Ç∫)">
                    <select id="transType" onchange="updateCategoryDropdown()">
                        <option value="expense">Gider / Bor√ß √ñdeme</option>
                        <option value="income">Gelir</option>
                    </select>
                </div>
                <select id="categorySelect"></select>
                <input type="date" id="date">
                
                <div class="check-group">
                    <input type="checkbox" id="isRecurring">
                    <label for="isRecurring">Her ay aynƒ± g√ºn tekrarla</label>
                </div>

                <button onclick="addTransaction()">KAYDET</button>
            </div>

            <div class="card">
                <h3>üìú ƒ∞≈ûLEM GE√áMƒ∞≈ûƒ∞ VE PLANLAR</h3>
                <div id="historyList" style="max-height: 500px; overflow-y: auto;"></div>
            </div>
        </div>

        <div class="col">
            <div class="card">
                <h3>üìâ BOR√áLARIN DURUMU</h3>
                <div style="display: flex; gap: 5px; margin-bottom:10px;">
                    <input type="text" id="debtName" placeholder="Bor√ß Adƒ±" style="margin:0">
                    <input type="number" id="debtAmt" placeholder="‚Ç∫" style="margin:0; width: 80px;">
                    <button onclick="addDebt()" style="width: 45px; background:var(--danger)">+</button>
                </div>
                <div id="debtList"></div>
            </div>

            <div class="card">
                <h3>üíé VARLIKLAR</h3>
                <div style="display: flex; gap: 5px; margin-bottom:10px;">
                    <input type="text" id="invName" placeholder="Varlƒ±k" style="margin:0">
                    <input type="number" id="invVal" placeholder="‚Ç∫" style="margin:0; width: 80px;">
                    <button onclick="addInvestment()" style="width: 45px; background:var(--success)">+</button>
                </div>
                <div id="investmentList"></div>
            </div>
        </div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem("cfo_time_pro")) || {
        transactions: [],
        categories: {
            income: ["Maa≈ü", "Freelance", "Kira Geliri"],
            expense: ["Market", "Fatura", "Kira", "Eƒülence"]
        },
        investments: [],
        debts: []
    };

    function save() { localStorage.setItem("cfo_time_pro", JSON.stringify(db)); }

    function updateCategoryDropdown() {
        const type = document.getElementById('transType').value;
        const select = document.getElementById('categorySelect');
        let html = db.categories[type].map(c => `<option value="${c}">${c}</option>`).join('');
        if(type === 'expense') {
            html += `<optgroup label="Bor√ßlar">` + db.debts.map(d => `<option value="BOR√á: ${d.name}">Bor√ß √ñdeme: ${d.name}</option>`).join('') + `</optgroup>`;
        }
        select.innerHTML = html;
    }

    function addDebt() {
        const name = document.getElementById('debtName').value.trim();
        const amt = Number(document.getElementById('debtAmt').value);
        if(name && amt) {
            db.debts.push({ id: Date.now(), name, remaining: amt });
            save(); render();
            document.getElementById('debtName').value = ""; document.getElementById('debtAmt').value = "";
        }
    }

    function addInvestment() {
        const name = document.getElementById('invName').value.trim();
        const val = Number(document.getElementById('invVal').value);
        if(name && val) { db.investments.push({ id: Date.now(), name, val }); save(); render(); }
    }

    function addTransaction() {
        const amt = Number(document.getElementById('amount').value);
        const type = document.getElementById('transType').value;
        const cat = document.getElementById('categorySelect').value;
        const date = document.getElementById('date').value;
        const isRec = document.getElementById('isRecurring').checked;

        if(!amt || !date) return alert("Hata!");

        db.transactions.unshift({
            id: Date.now(),
            amt, type, cat, date,
            recurring: isRec,
            status: "pending"
        });
        
        save(); render();
        document.getElementById('amount').value = "";
        document.getElementById('isRecurring').checked = false;
    }

    function render() {
        const today = new Date();
        today.setHours(0,0,0,0);
        document.getElementById('todayStr').textContent = "Bug√ºn√ºn Tarihi: " + today.toLocaleDateString('tr-TR');
        updateCategoryDropdown();

        let currentCash = 0;
        let pendingInc = 0;
        let pendingExp = 0;
        let totalDebt = 0;
        let totalInv = 0;

        // Varlƒ±klar ve Bor√ßlarƒ± Hesapla (Statik)
        db.investments.forEach(i => totalInv += i.val);
        const dList = document.getElementById('debtList'); dList.innerHTML = "";
        db.debts.forEach(d => {
            totalDebt += d.remaining;
            dList.innerHTML += `<div class="list-item"><span>${d.name}</span><span class="val-exp">${d.remaining.toLocaleString()} ‚Ç∫</span></div>`;
        });

        const hList = document.getElementById('historyList'); hList.innerHTML = "";
        
        // ƒ∞≈ûLEMLERƒ∞ ANALƒ∞Z ET
        db.transactions.sort((a,b) => new Date(b.date) - new Date(a.date)).forEach(t => {
            const tDate = new Date(t.date);
            tDate.setHours(0,0,0,0);

            const isFuture = tDate > today;
            let displayClass = "";

            if (!isFuture) {
                // BUG√úN VEYA GE√áMƒ∞≈û: Kasaya etkile
                if (t.type === 'income') currentCash += t.amt;
                else {
                    currentCash -= t.amt;
                    // Eƒüer bor√ß √∂demesiyse ve daha √∂nce bor√ßtan d√º≈ü√ºlmediyse (basit mantƒ±k i√ßin her render'da hesaplƒ±yoruz)
                    if(t.cat.startsWith("BOR√á: ")) {
                        // Bor√ß d√º≈üme mantƒ±ƒüƒ± burada her renderda sƒ±fƒ±rdan hesaplanmalƒ± 
                        // ya da i≈ülem eklendiƒüi an bor√ß objesi g√ºncellenmeli.
                        // Senin senaryonda "zamanƒ± gelince bor√ßtan d√º≈üs√ºn" dediƒüin i√ßin:
                        const dName = t.cat.replace("BOR√á: ", "");
                        const debtObj = db.debts.find(d => d.name === dName);
                        // Not: Bu basit √∂rnekte bor√ß d√º≈ümeyi karma≈üƒ±kla≈ütƒ±rmamak i√ßin 
                        // bor√ß objesini i≈ülem eklendiƒüinde g√ºncellemek en saƒülƒ±klƒ±sƒ±dƒ±r.
                    }
                }
                displayClass = t.type === 'income' ? 'val-inc' : 'val-exp';
            } else {
                // GELECEK: Bekleyenlere ekle
                if (t.type === 'income') pendingInc += t.amt;
                else pendingExp += t.amt;
                displayClass = 'val-wait';
            }

            hList.innerHTML += `
                <div class="list-item" style="${isFuture ? 'border-left: 3px solid var(--warning); padding-left:10px;' : ''}">
                    <div>
                        <b>${t.cat}</b> ${t.recurring ? 'üîÑ' : ''}<br>
                        <small>${t.date} ${isFuture ? '(BEKLEYEN)' : ''}</small>
                    </div>
                    <span class="${displayClass}">${t.type === 'income' ? '+' : '-'}${t.amt.toLocaleString()} ‚Ç∫</span>
                </div>`;
        });

        // Dashboard G√ºncelle
        document.getElementById('netWorthDisplay').textContent = (currentCash + totalInv).toLocaleString() + " ‚Ç∫";
        document.getElementById('pendingInfo').innerHTML = 
            `üìÖ Yakla≈üan: <span class="val-inc">+${pendingInc.toLocaleString()}</span> / <span class="val-exp">-${pendingExp.toLocaleString()} ‚Ç∫</span>`;

        // AI Analizi
        let aiMsg = "";
        if (pendingExp > (currentCash + pendingInc)) {
            aiMsg = "‚ö†Ô∏è <b>Dƒ∞KKAT:</b> Gelecek ayki √∂demelerin mevcut kasanƒ± ve beklenen maa≈üƒ±nƒ± a≈üƒ±yor! Bor√ßlanma riski var.";
        } else if (pendingExp > 0) {
            aiMsg = `‚úÖ Mart ayƒ± i√ßin <b>${pendingExp.toLocaleString()} ‚Ç∫</b> √∂demen planlanmƒ±≈ü. Maa≈üƒ±n yattƒ±ƒüƒ±nda kasan g√ºvende kalacak.`;
        }
        document.getElementById('aiReport').innerHTML = aiMsg;

        const iList = document.getElementById('investmentList'); iList.innerHTML = "";
        db.investments.forEach(i => {
            iList.innerHTML += `<div class="list-item"><span>${i.name}</span><span class="val-inc">${i.val.toLocaleString()} ‚Ç∫</span></div>`;
        });
    }

    function clearAll() { if(confirm("T√ºm veriler silinsin mi?")) { localStorage.clear(); location.reload(); } }
    document.getElementById('date').valueAsDate = new Date();
    render();
    
    // Her g√ºn deƒüi≈ütiƒüinde kontrol etmesi i√ßin basit bir interval (opsiyonel)
    setInterval(render, 3600000); 
</script>
</body>
</html>
