<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KiÅŸisel CFO PRO - Final</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee; --success: #10b981; --danger: #ef4444; 
            --warning: #f59e0b; --info: #3b82f6; --bg: #0f172a; 
            --card: #1e293b; --border: #334155; --text: #f8fafc; --text-dim: #94a3b8;
        }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 20px; font-size: 13px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .grid { display: grid; grid-template-columns: 350px 1fr 350px; gap: 20px; }
        .card { background: var(--card); border-radius: 16px; border: 1px solid var(--border); padding: 20px; margin-bottom: 20px; }
        .card h3 { margin: 0 0 15px 0; font-size: 12px; font-weight: 700; text-transform: uppercase; color: var(--info); letter-spacing: 1px; }
        .net-worth { font-size: 32px; font-weight: 800; color: #fff; margin-bottom: 10px; }
        
        .ai-box { background: rgba(59, 130, 246, 0.1); border: 1px solid var(--info); border-radius: 12px; padding: 15px; }
        .ai-msg { line-height: 1.6; color: #e2e8f0; font-size: 12.5px; }

        input, select { width: 100%; padding: 12px; background: #0f172a; border: 1px solid var(--border); border-radius: 8px; color: #fff; margin-bottom: 10px; }
        button { width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; background: var(--primary); color: white; transition: 0.2s; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px dashed var(--border); }
        .val-inc { color: var(--success); } .val-exp { color: var(--danger); }
        
        .cat-badge { background: var(--border); padding: 4px 8px; border-radius: 8px; font-size: 10px; display: inline-flex; align-items: center; gap: 5px; margin: 2px; }
        .cat-del { cursor: pointer; color: var(--danger); font-weight: bold; }
        
        @media (max-width: 1100px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
        <h1 style="margin:0; font-size: 22px;">KÄ°ÅÄ°SEL <span style="color:var(--primary)">CFO PRO</span></h1>
        <button onclick="clearAll()" style="width:auto; background:none; color:var(--text-dim); border:1px solid var(--border); padding: 5px 15px;">SÄ±fÄ±rla</button>
    </header>

    <div class="grid">
        <div class="col">
            <div class="card">
                <h3>ğŸ’° NET VARLIK</h3>
                <div class="net-worth" id="netWorthDisplay">0 â‚º</div>
                <div id="assetLiabInfo" style="font-size: 11px; color: var(--text-dim);"></div>
            </div>

            <div class="card">
                <h3>ğŸ·ï¸ KATEGORÄ° EKLE</h3>
                <div style="display: flex; gap: 5px; margin-bottom: 10px;">
                    <input type="text" id="newCatName" placeholder="Kategori AdÄ±..." style="margin:0">
                    <select id="newCatType" style="margin:0; width: 80px;">
                        <option value="expense">Gider</option>
                        <option value="income">Gelir</option>
                    </select>
                    <button onclick="addCustomCategory()" style="width: 50px;">+</button>
                </div>
                <div id="catListDisplay"></div>
            </div>

            <div class="card">
                <h3>ğŸ¤– CFO ANALÄ°Z RAPORU</h3>
                <div class="ai-box">
                    <div id="aiReport" class="ai-msg">Veri giriÅŸi bekleniyor...</div>
                </div>
            </div>
        </div>

        <div class="col">
            <div class="card">
                <h3>ğŸ’³ YENÄ° Ä°ÅLEM GÄ°RÄ°ÅÄ°</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <input type="number" id="amount" placeholder="Tutar (â‚º)">
                    <select id="transType" onchange="updateCategoryDropdown()">
                        <option value="expense">Gider / BorÃ§ Ã–deme (-)</option>
                        <option value="income">Gelir (+)</option>
                    </select>
                </div>
                <select id="categorySelect">
                    </select>
                <input type="text" id="note" placeholder="AÃ§Ä±klama">
                <input type="date" id="date">
                <button onclick="addTransaction()">KAYDET</button>
            </div>

            <div class="card">
                <h3>ğŸ“œ Ä°ÅLEM GEÃ‡MÄ°ÅÄ°</h3>
                <div id="historyList" style="max-height: 400px; overflow-y: auto;"></div>
            </div>
        </div>

        <div class="col">
            <div class="card" style="border-top: 3px solid var(--danger);">
                <h3>ğŸ“‰ AKTÄ°F BORÃ‡LAR</h3>
                <div style="display: flex; gap: 5px; margin-bottom:10px;">
                    <input type="text" id="debtName" placeholder="BorÃ§ AdÄ±" style="margin:0">
                    <input type="number" id="debtAmt" placeholder="â‚º" style="margin:0; width: 80px;">
                    <button onclick="addDebt()" style="width: 45px; background:var(--danger)">+</button>
                </div>
                <div id="debtList"></div>
            </div>

            <div class="card" style="border-top: 3px solid var(--success);">
                <h3>ğŸ’ VARLIKLAR / YATIRIM</h3>
                <div style="display: flex; gap: 5px; margin-bottom:10px;">
                    <input type="text" id="invName" placeholder="VarlÄ±k" style="margin:0">
                    <input type="number" id="invVal" placeholder="â‚º" style="margin:0; width: 80px;">
                    <button onclick="addInvestment()" style="width: 45px; background:var(--success)">+</button>
                </div>
                <div id="investmentList"></div>
            </div>

            <div class="card">
                <h3>ğŸ“Š GÄ°DER DAÄILIMI</h3>
                <canvas id="mainChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem("cfo_final_pro")) || {
        transactions: [],
        categories: {
            income: ["MaaÅŸ", "Freelance", "Kira Geliri", "SatÄ±ÅŸ"],
            expense: ["Market", "Fatura", "Kira", "EÄŸlence", "UlaÅŸÄ±m"]
        },
        investments: [],
        debts: []
    };

    let chart;
    function save() { localStorage.setItem("cfo_final_pro", JSON.stringify(db)); }

    function addCustomCategory() {
        const name = document.getElementById('newCatName').value.trim();
        const type = document.getElementById('newCatType').value;
        if(name && !db.categories[type].includes(name)) {
            db.categories[type].push(name);
            document.getElementById('newCatName').value = "";
            save(); render();
        }
    }

    function removeCategory(type, name) {
        db.categories[type] = db.categories[type].filter(c => c !== name);
        save(); render();
    }

    function updateCategoryDropdown() {
        const type = document.getElementById('transType').value;
        const select = document.getElementById('categorySelect');
        let html = db.categories[type].map(c => `<option value="${c}">${c}</option>`).join('');
        
        if(type === 'expense') {
            let debtOptions = db.debts.map(d => `<option value="BORÃ‡: ${d.name}">Ã–DEME: ${d.name}</option>`).join('');
            html += `<optgroup label="BorÃ§lar">${debtOptions}</optgroup>`;
        }
        select.innerHTML = html;
    }

    function addDebt() {
        const name = document.getElementById('debtName').value.trim();
        const amt = Number(document.getElementById('debtAmt').value);
        if(name && amt) {
            db.debts.push({ id: Date.now(), name, remaining: amt });
            save(); render();
            document.getElementById('debtName').value = ""; document.getElementById('debtAmt').value = "";
        }
    }

    function addInvestment() {
        const name = document.getElementById('invName').value.trim();
        const val = Number(document.getElementById('invVal').value);
        if(name && val) {
            db.investments.push({ id: Date.now(), name, val });
            save(); render();
            document.getElementById('invName').value = ""; document.getElementById('invVal').value = "";
        }
    }

    function addTransaction() {
        const amt = Number(document.getElementById('amount').value);
        const type = document.getElementById('transType').value;
        const cat = document.getElementById('categorySelect').value;
        const date = document.getElementById('date').value;
        const note = document.getElementById('note').value;

        if(!amt || !date) return alert("Hata: Tutar ve tarih girilmelidir.");

        if(type === 'expense' && cat.startsWith("BORÃ‡: ")) {
            const dName = cat.replace("BORÃ‡: ", "");
            const idx = db.debts.findIndex(d => d.name === dName);
            if(idx !== -1) db.debts[idx].remaining -= amt;
        }

        db.transactions.unshift({ id: Date.now(), amt, type, cat, date, note });
        save(); render();
        document.getElementById('amount').value = "";
    }

    function render() {
        updateCategoryDropdown();
        
        // Kategori Listesini GÃ¶rÃ¼ntÃ¼le
        let catHTML = "<b>Gelir:</b><br>";
        db.categories.income.forEach(c => catHTML += `<span class="cat-badge">${c} <span class="cat-del" onclick="removeCategory('income','${c}')">Ã—</span></span>`);
        catHTML += "<br><br><b>Gider:</b><br>";
        db.categories.expense.forEach(c => catHTML += `<span class="cat-badge">${c} <span class="cat-del" onclick="removeCategory('expense','${c}')">Ã—</span></span>`);
        document.getElementById('catListDisplay').innerHTML = catHTML;

        let incTotal = 0, expTotal = 0, debtRem = 0, invTotal = 0, dPay = 0;
        let catStats = {};

        // BorÃ§lar
        const dList = document.getElementById('debtList'); dList.innerHTML = "";
        db.debts.forEach(d => {
            debtRem += d.remaining;
            dList.innerHTML += `<div class="list-item"><span>${d.name}</span><span class="val-exp">${d.remaining.toLocaleString()} â‚º</span></div>`;
        });

        // Ä°ÅŸlemler
        const hList = document.getElementById('historyList'); hList.innerHTML = "";
        db.transactions.forEach(t => {
            if(t.type === 'income') incTotal += t.amt;
            else {
                expTotal += t.amt;
                catStats[t.cat] = (catStats[t.cat] || 0) + t.amt;
                if(t.cat.startsWith("BORÃ‡: ")) dPay += t.amt;
            }
            hList.innerHTML += `<div class="list-item"><div><b>${t.cat}</b><br><small>${t.date}</small></div><span class="val-${t.type==='income'?'inc':'exp'}">${t.amt.toLocaleString()} â‚º</span></div>`;
        });

        // VarlÄ±klar
        const iList = document.getElementById('investmentList'); iList.innerHTML = "";
        db.investments.forEach(i => {
            invTotal += i.val;
            iList.innerHTML += `<div class="list-item"><span>${i.name}</span><span class="val-inc">${i.val.toLocaleString()} â‚º</span></div>`;
        });

        const net = (incTotal + invTotal) - (expTotal + debtRem);
        document.getElementById('netWorthDisplay').textContent = net.toLocaleString() + " â‚º";
        document.getElementById('assetLiabInfo').innerHTML = `Toplam VarlÄ±k: ${(incTotal+invTotal).toLocaleString()} â‚º | BorÃ§ YÃ¼kÃ¼: ${debtRem.toLocaleString()} â‚º`;

        updateChart(catStats);
        runAI(incTotal, expTotal, debtRem, dPay);
    }

    function runAI(inc, exp, dRem, dPay) {
        let msg = "";
        if(inc > 0) {
            let saveRate = ((inc - exp) / inc) * 100;
            msg += `ğŸ’° Gelirinizin <b>%${saveRate.toFixed(1)}</b> kadarÄ±nÄ± biriktiriyorsunuz. `;
            if(saveRate < 10) msg += "Tasarruf oranÄ±nÄ±z dÃ¼ÅŸÃ¼k, harcamalarÄ± gÃ¶zden geÃ§irin. ";
        }
        if(dRem > 0 && dPay > 0) {
            let months = Math.ceil(dRem / dPay);
            msg += `<br><br>ğŸ“‰ Mevcut Ã¶deme hÄ±zÄ±yla borÃ§larÄ±nÄ±z <b>${months} ay</b> sonra bitecek. `;
        }
        document.getElementById('aiReport').innerHTML = msg || "HenÃ¼z analiz iÃ§in yeterli veri yok.";
    }

    function updateChart(data) {
        const ctx = document.getElementById('mainChart').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, { type: 'pie', data: { labels: Object.keys(data), datasets: [{ data: Object.values(data), backgroundColor: ['#4361ee', '#10b981', '#ef4444', '#f59e0b', '#3b82f6'], borderWidth: 0 }] }, options: { plugins: { legend: { display: false } } } });
    }

    function clearAll() { if(confirm("SÄ±fÄ±rlansÄ±n mÄ±?")) { localStorage.clear(); location.reload(); } }
    document.getElementById('date').valueAsDate = new Date();
    render();
</script>
</body>
</html>
